<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jpcorewords</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 15px;
            max-width: 100%;
            overflow-x: hidden;
            overflow-y: scroll;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }
        body::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
        h1 {
            font-size: clamp(20px, 5vw, 28px);
            margin: 10px 0 20px 0;
        }
        .button-container {
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .vocab-button {
            padding: 10px 15px;
            font-size: clamp(14px, 3vw, 16px);
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            flex: 1 1 auto;
            min-width: 100px;
        }
        .vocab-button:hover {
            background-color: #45a049;
        }
        .vocab-button.active {
            background-color: #2196F3;
        }
        .mode-button {
            padding: 10px 15px;
            font-size: clamp(14px, 3vw, 16px);
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            flex: 1 1 auto;
            min-width: 80px;
        }
        .mode-button:hover {
            background-color: #45a049;
        }
        .mode-button.active {
            background-color: #2196F3;
        }
        
        .flashcard-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
            width: 100%;
        }
        .flashcard {
            width: min(700px, 95vw);
            height: min(400px, 60vh);
            background: white;
            border: 2px solid #333;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: transform 0.3s;
            padding: 20px;
            position: relative;
        }
        
        @media (min-width: 768px) {
            .flashcard {
                width: 700px;
                height: 400px;
            }
        }
        .flashcard:hover {
            transform: scale(1.02);
        }
        .flashcard.flipped {
            background: #f0f0f0;
        }
        .card-number {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: clamp(12px, 2.5vw, 14px);
            color: #666;
        }
        .card-word {
            font-size: clamp(40px, 10vw, 64px);
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            word-break: break-word;
        }
        .card-reading {
            font-size: clamp(18px, 4vw, 24px);
            color: #666;
            margin-bottom: 20px;
            text-align: center;
        }
        .card-meaning {
            font-size: clamp(32px, 8vw, 48px);
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            word-break: break-word;
        }
        .card-english {
            font-size: clamp(18px, 4vw, 24px);
            color: #666;
            margin-bottom: 20px;
            text-align: center;
        }
        .flashcard-controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            width: 100%;
            max-width: 300px;
            justify-content: center;
        }
        .control-btn {
            padding: 12px 20px;
            font-size: clamp(14px, 3vw, 16px);
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #2196F3;
            color: white;
            flex: 1;
            min-width: 50px;
        }
        .control-btn:hover {
            background-color: #1976D2;
        }
        .control-btn:disabled {
            background-color: #ccc;
        }
        .progress {
            margin-top: 10px;
            font-size: clamp(14px, 3vw, 18px);
            color: #666;
            text-align: center;
        }
        .speed-control {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }
        .speed-control label {
            width: 100%;
            text-align: center;
            margin-bottom: 5px;
            display: none;
        }
        .speed-btn {
            padding: 10px 18px;
            font-size: clamp(13px, 2.8vw, 16px);
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #9E9E9E;
            color: white;
        }
        .speed-btn:hover {
            background-color: #757575;
        }
        .speed-btn.active {
            background-color: #000000;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 30px;
            font-size: clamp(12px, 2.5vw, 14px);
            overflow-x: auto;
            display: block;
        }
        th, td {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        .hidden {
            color: transparent;
            background-color: #ddd;
            user-select: none;
            cursor: pointer;
        }
        .hidden:hover {
            background-color: #ccc;
        }
        h2 {
            margin-top: 30px;
            font-size: clamp(18px, 4vw, 24px);
        }
        .table-view {
            display: none;
        }
        .flashcard-view {
            display: block;
        }

        .audio-btn {
            position: absolute;
            top: 10px;
            right: 45px;
            padding: 6px 8px;
            font-size: clamp(12px, 2.5vw, 16px);
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #c4c4c4;
            color: rgb(255, 255, 255);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .audio-btn:hover {
            background-color: #000000;
        }
        .save-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 6px 8px;
            font-size: clamp(12px, 2.5vw, 16px);
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #FFC107;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .save-btn:hover {
            background-color: #FFA000;
        }
        .save-btn.saved {
            background-color: #4CAF50;
        }
        .saved-words-section {
            margin-top: 40px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 10px;
            border: 2px solid #ddd;
        }
        .saved-words-section-header {
            color: white;
            background: #2196F3;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .saved-words-section-header h2,.saved-words-section-header button {
            margin: 0;
        }
        .saved-word-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .saved-word-content {
            flex: 1;
        }
        .saved-word-japanese {
            font-size: clamp(20px, 4vw, 24px);
            font-weight: bold;
            margin-bottom: 5px;
        }
        .saved-word-reading {
            font-size: clamp(14px, 3vw, 16px);
            color: #666;
            margin-bottom: 5px;
        }
        .saved-word-meaning {
            font-size: clamp(16px, 3vw, 18px);
            color: #333;
        }
        .delete-btn {
            padding: 8px 12px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: clamp(12px, 2.5vw, 14px);
        }
        .delete-btn:hover {
            background-color: #d32f2f;
        }
        .clear-all-btn {
            padding: 8px 12px;
            background-color: #991910;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: clamp(12px, 2.5vw, 14px);
        }
        .clear-all-btn:hover {
            background-color: #771111;
        }
        .settings-control {
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .checkbox-label {
            margin-left: 8px;
            font-size: clamp(14px, 3vw, 16px);
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .flashcard {
                border-radius: 10px;
                padding: 15px;
            }
            .speed-btn, .control-btn, .vocab-button, .mode-button {
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
        }
    </style>
</head>
<body>
    <h1>Japanese Core Vocabulary</h1>
    
    <div class="button-container">
        <button class="vocab-button active" onclick="loadVocab('core1000', this)">Core 1000</button>
        <button class="vocab-button" onclick="loadVocab('core2000', this)">Core 2000</button>
        <button class="vocab-button" onclick="loadVocab('core3000', this)">Core 3000</button>
        <button class="vocab-button" onclick="loadVocab('core4000', this)">Core 4000</button>
        <button class="vocab-button" onclick="loadVocab('core5000', this)">Core 5000</button>
        <button class="vocab-button" onclick="loadVocab('core6000', this)">Core 6000</button>
    </div>
    
    <div class="button-container">
        <button class="mode-button active" onclick="setMode('flashcard', this)">flashcard</button>
        <button class="mode-button" onclick="setMode('showAll', this)">all</button>
        <button class="mode-button" onclick="setMode('hideJapanese', this)">definition</button>
        <button class="mode-button" onclick="setMode('hideMeaning', this)">words</button>
    </div>
    
    <div id="flashcard-view" class="flashcard-view">
        <div class="flashcard-container">
            <div class="flashcard" id="flashcard" onclick="flipCard()">
                <div class="card-number" id="cardNumber"></div>
                <button class="audio-btn" onclick="playAudio(event)"><i class="fa-solid fa-volume-high"></i></button>
                <button class="save-btn" id="saveBtn" onclick="toggleSaveWord(event)"><i class="fa-solid fa-bookmark"></i></button>
                <div id="cardFront">
                    <div class="card-word" id="cardWord"></div>
                    <div class="card-reading" id="cardReading"></div>
                </div>
                <div id="cardBack" style="display:none;">
                    <div class="card-meaning" id="cardMeaning"></div>
                    <div class="card-english" id="cardEnglish"></div>
                </div>
            </div>
            
            <div class="flashcard-controls">
                <button class="control-btn" onclick="prevCard()" id="prevBtn"><i class="fa-solid fa-arrow-left-long"></i></button>
                <button class="control-btn" onclick="toggleAutoPlay()" id="autoPlayBtn"><i class="fa-solid fa-play"></i></button>
                <button class="control-btn" onclick="nextCard()" id="nextBtn"><i class="fa-solid fa-arrow-right-long"></i></i></button>
            </div>
            
            <div class="speed-control">
                <button class="speed-btn" onclick="setSpeed(2000,this)">低速</button>
                <button class="speed-btn active" onclick="setSpeed(1000,this)">標準</button>
                <button class="speed-btn" onclick="setSpeed(500,this)">高速</button>
            </div>
            
            <div class="settings-control">
                <label class="checkbox-label" for="autoAudioCheck">自動音声再生</label>
                <input type="checkbox" id="autoAudioCheck" checked>
            </div>
            
            <div class="progress" id="progress"></div>
        </div>
    </div>
    
    <div id="table-view" class="table-view"></div>
    
    <div id="saved-words-section" class="saved-words-section" style="display:none;">
        <div id="saved-words-section-header"class="saved-words-section-header">
            <h2>単語帳 (<span id="savedCount">0</span>)</h2>
            <button class="clear-all-btn" onclick="clearAllSaved()"><i class="fa-solid fa-trash"></i></button>
        </div>
        <div id="saved-words-list"></div>
    </div>
    
    <script src="core1000.js"></script>
    <script src="core2000.js"></script>
    <script src="core3000.js"></script>
    <script src="core4000.js"></script>
    <script src="core5000.js"></script>
    <script src="core6000.js"></script>
    <script>
        let currentVocab = 'core1000';
        let currentMode = 'flashcard';
        let currentData = null;
        let allWords = [];
        let currentIndex = 0;
        let isFlipped = false;
        let autoPlayInterval = null;
        let autoPlaySpeed = 1000;
        let speechSynthesis = window.speechSynthesis;
        let japaneseVoice = null;
        let savedWords = [];

        function initVoice() {
            const voices = speechSynthesis.getVoices();
            japaneseVoice = voices.find(voice => voice.lang === 'ja-JP');
            if (!japaneseVoice) {
                japaneseVoice = voices.find(voice => voice.lang.startsWith('ja'));
            }
            console.log('Available voices:', voices.length);
            console.log('Japanese voice:', japaneseVoice);
        }

        speechSynthesis.onvoiceschanged = initVoice;
        setTimeout(initVoice, 100);

        function loadVocab(vocabType, buttonElement) {
            document.querySelectorAll('.vocab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            buttonElement.classList.add('active');
            
            currentVocab = vocabType;
            
            if (vocabType === 'core1000') {
                currentData = core1000;
            } else if (vocabType === 'core2000') {
                currentData = core2000;
            } else if (vocabType === 'core3000') {
                currentData = core3000;
            } else if (vocabType === 'core4000') {
                currentData = core4000;
            } else if (vocabType === 'core5000') {
                currentData = core5000;
            } else if (vocabType === 'core6000') {
                currentData = core6000;
            }
            
            prepareWordList();
            currentIndex = 0;
            
            if (currentMode === 'flashcard') {
                showCard();
            } else {
                displayVocabulary();
            }
        }

        function setMode(mode, buttonElement) {
            document.querySelectorAll('.mode-button').forEach(btn => {
                btn.classList.remove('active');
            });
            buttonElement.classList.add('active');
            
            currentMode = mode;
            
            if (mode === 'flashcard') {
                document.getElementById('flashcard-view').style.display = 'block';
                document.getElementById('table-view').style.display = 'none';
                prepareWordList();
                showCard();
            } else {
                document.getElementById('flashcard-view').style.display = 'none';
                document.getElementById('table-view').style.display = 'block';
                stopAutoPlay();
                displayVocabulary();
            }
        }

        function prepareWordList() {
            allWords = [];
            for (let i = 1; i <= 10; i++) {
                const key = `core${i}`;
                if (currentData[key]) {
                    currentData[key].forEach((item, index) => {
                        allWords.push({
                            number: (index + 1) + ((i - 1) * 100),
                            ...item
                        });
                    });
                }
            }
        }

        function showCard() {
            if (allWords.length === 0) return;
            
            const word = allWords[currentIndex];
            document.getElementById('cardNumber').textContent = `${currentIndex + 1} / ${allWords.length}`;
            document.getElementById('cardWord').textContent = word.word;
            document.getElementById('cardReading').textContent = word.reading;
            document.getElementById('cardMeaning').textContent = word.korean;
            document.getElementById('cardEnglish').textContent = word.meaning;
            
            document.getElementById('cardFront').style.display = 'block';
            document.getElementById('cardBack').style.display = 'none';
            document.getElementById('flashcard').classList.remove('flipped');
            isFlipped = false;
            
            document.getElementById('progress').textContent = `Card ${currentIndex + 1} of ${allWords.length}`;
            document.getElementById('prevBtn').disabled = currentIndex === 0;
            document.getElementById('nextBtn').disabled = currentIndex === allWords.length - 1;
        
            if (document.getElementById('autoAudioCheck').checked) {
                setTimeout(() => playAudio(), 100);
            }
            
            updateSaveButton();
        }

        function updateSaveButton() {
            const word = allWords[currentIndex];
            const wordKey = `${currentVocab}-${word.number}`;
            const isSaved = savedWords.some(w => `${w.vocab}-${w.number}` === wordKey);
            const saveBtn = document.getElementById('saveBtn');
            
            if (isSaved) {
                saveBtn.classList.add('saved');
                saveBtn.innerHTML = '<i class="fa-solid fa-bookmark"></i>';
            } else {
                saveBtn.classList.remove('saved');
                saveBtn.innerHTML = '<i class="fa-regular fa-bookmark"></i>';
            }
        }

        function toggleSaveWord(event) {
            if (event) {
                event.stopPropagation();
            }
            
            if (allWords.length === 0) return;
            
            const word = allWords[currentIndex];
            const wordKey = `${currentVocab}-${word.number}`;
            const existingIndex = savedWords.findIndex(w => `${w.vocab}-${w.number}` === wordKey);
            
            if (existingIndex !== -1) {
                savedWords.splice(existingIndex, 1);
            } else {
                savedWords.push({ ...word, vocab: currentVocab });
            }
            
            localStorage.setItem('savedWords', JSON.stringify(savedWords));
            updateSaveButton();
            displaySavedWords();
        }

        function displaySavedWords() {
            const section = document.getElementById('saved-words-section');
            const list = document.getElementById('saved-words-list');
            const count = document.getElementById('savedCount');
            
            if (savedWords.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            count.textContent = savedWords.length;
            
            let html = '';
            savedWords.forEach((word, index) => {
                const vocabLabel = word.vocab === 'core1000' ? 'Core 1000' : word.vocab === 'core2000' ? 'Core 2000' : word.vocab === 'core3000' ? 'Core 3000' : word.vocab === 'core4000' ? 'Core 4000' : word.vocab === 'core5000' ? 'Core 5000' : 'Core 6000';
                html += `
                    <div class="saved-word-item">
                        <div class="saved-word-content">
                            <div class="saved-word-japanese">${word.word} <span style="font-size: 14px; color: #999;">(${vocabLabel} #${word.number})</span></div>
                            <div class="saved-word-reading">${word.reading}</div>
                            <div class="saved-word-meaning">${word.korean} - ${word.meaning}</div>
                        </div>
                        <button class="delete-btn" onclick="deleteSavedWord(${index})">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                `;
            });
            
            list.innerHTML = html;
        }

        function deleteSavedWord(index) {
            savedWords.splice(index, 1);
            localStorage.setItem('savedWords', JSON.stringify(savedWords));
            displaySavedWords();
            updateSaveButton();
        }

        function clearAllSaved() {
            if (confirm("削除しますか？")) {
                savedWords = [];
                localStorage.setItem('savedWords', JSON.stringify(savedWords));
                displaySavedWords();
                updateSaveButton();
            }
        }

        function flipCard() {
            isFlipped = !isFlipped;
            if (isFlipped) {
                document.getElementById('cardFront').style.display = 'none';
                document.getElementById('cardBack').style.display = 'block';
                document.getElementById('flashcard').classList.add('flipped');
            } else {
                document.getElementById('cardFront').style.display = 'block';
                document.getElementById('cardBack').style.display = 'none';
                document.getElementById('flashcard').classList.remove('flipped');
            }
        }

        function nextCard() {
            if (currentIndex < allWords.length - 1) {
                currentIndex++;
                showCard();
            }
        }

        function prevCard() {
            if (currentIndex > 0) {
                currentIndex--;
                showCard();
            }
        }

        function toggleAutoPlay() {
            if (autoPlayInterval) {
                stopAutoPlay();
            } else {
                startAutoPlay();
            }
        }

        function startAutoPlay() {
            document.getElementById('autoPlayBtn').innerHTML = `<i class="fa-solid fa-pause"></i>`;
            autoPlayInterval = setInterval(() => {
                if (!isFlipped) {
                    flipCard();
                } else {
                    if (currentIndex < allWords.length - 1) {
                        nextCard();
                    } else {
                        stopAutoPlay();
                    }
                }
            }, autoPlaySpeed);
        }

        function stopAutoPlay() {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
                document.getElementById('autoPlayBtn').innerHTML = `<i class="fa-solid fa-play"></i>`;
            }
        }

        function setSpeed(speed, buttonElement) {
            autoPlaySpeed = speed;
            
            document.querySelectorAll('.speed-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            buttonElement.classList.add('active');
            
            if (autoPlayInterval) {
                stopAutoPlay();
                startAutoPlay();
            }
        }

        function displayVocabulary() {
            let html = '';
            
            for (let i = 1; i <= 10; i++) {
                const key = `core${i}`;
                if (currentData[key]) {
                    html += `<h2>Core ${i}</h2>`;
                    html += '<table>';
                    html += '<tr><th>number</th><th>Word</th><th>Reading</th><th>Korean</th><th>Meaning</th></tr>';
                    
                    currentData[key].forEach((item, index) => {
                        html += '<tr>';
                        html += `<td>${(index + 1) + ((i - 1) * 100)}</td>`;
                        
                        if (currentMode === 'hideJapanese') {
                            html += `<td class="hidden" onclick="this.classList.toggle('hidden')">${item.word}</td>`;
                            html += `<td class="hidden" onclick="this.classList.toggle('hidden')">${item.reading}</td>`;
                            html += `<td>${item.korean}</td>`;
                            html += `<td>${item.meaning}</td>`;
                        } else if (currentMode === 'hideMeaning') {
                            html += `<td>${item.word}</td>`;
                            html += `<td>${item.reading}</td>`;
                            html += `<td class="hidden" onclick="this.classList.toggle('hidden')">${item.korean}</td>`;
                            html += `<td class="hidden" onclick="this.classList.toggle('hidden')">${item.meaning}</td>`;
                        } else {
                            html += `<td>${item.word}</td>`;
                            html += `<td>${item.reading}</td>`;
                            html += `<td>${item.korean}</td>`;
                            html += `<td>${item.meaning}</td>`;
                        }
                        
                        html += '</tr>';
                    });
                    
                    html += '</table>';
                }
            }
            
            document.getElementById('table-view').innerHTML = html;
        }

        function playAudio(event) {
            if (event) {
                event.stopPropagation();
            }
            
            if (allWords.length === 0) return;
            
            const word = allWords[currentIndex];
            const utterance = new SpeechSynthesisUtterance(word.word);
            utterance.lang = 'ja-JP';
            utterance.rate = 0.8;
            
            if (japaneseVoice) {
                utterance.voice = japaneseVoice;
            }
            
            speechSynthesis.cancel();
            speechSynthesis.speak(utterance);
        }

        document.addEventListener('keydown', function(event) {
            if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
                return;
            }
            
            if (event.code === 'Space') {
                event.preventDefault();
                if (currentMode === 'flashcard') {
                    toggleAutoPlay();
                }
            }
            else if (event.code === 'ArrowLeft') {
                event.preventDefault();
                if (currentMode === 'flashcard') {
                    prevCard();
                }
            }
            else if (event.code === 'ArrowRight') {
                event.preventDefault();
                if (currentMode === 'flashcard') {
                    nextCard();
                }
            }
            else if (event.code === 'Enter') {
                event.preventDefault();
                if (currentMode === 'flashcard') {
                    flipCard();
                }
            }
            else if (event.code === 'KeyB') {
                event.preventDefault();
                if (currentMode === 'flashcard') {
                    toggleSaveWord();
                }
            }
        });

        currentData = core1000;
        prepareWordList();
        showCard();
        
        // Load saved words from localStorage
        const storedWords = localStorage.getItem('savedWords');
        if (storedWords) {
            try {
                savedWords = JSON.parse(storedWords);
                displaySavedWords();
            } catch (e) {
                console.error('Error loading saved words:', e);
                savedWords = [];
            }
        }
    </script>
</body>
</html>